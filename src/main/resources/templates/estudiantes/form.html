<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Formulario Estudiante</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container mt-4">

    <h2 th:text="${estudiante.id == null ? 'Nuevo Estudiante' : 'Editar Estudiante'}"></h2>

    <form th:action="@{/estudiantes}" th:object="${estudiante}" method="post">

        <!-- Solo incluir ID si existe (para edición) -->
        <input type="hidden" th:field="*{id}" th:if="${estudiante.id != null}"/>

        <!-- Datos de Identificación -->
        <div class="card mt-3">
            <div class="card-header bg-primary text-white">
                <h5>Datos de Identificación</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label>Tipo Documento</label>
                        <select th:field="*{tipoDocumento}" class="form-control">
                            <option value="">Seleccione...</option>
                            <option value="CC">CC</option>
                            <option value="TI">TI</option>
                            <option value="CE">CE</option>
                        </select>
                    </div>

                    <div class="col-md-3 mb-3">
                        <label>Documento *</label>
                        <input type="text" th:field="*{documento}" class="form-control" required/>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Registro</label>
                        <input type="text" th:field="*{registro}" class="form-control" placeholder="EK20183007722"/>
                    </div>
                </div>
            </div>
        </div>

        <!-- Datos Personales -->
        <div class="card mt-3">
            <div class="card-header bg-info text-white">
                <h5>Datos Personales</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label>Primer Nombre *</label>
                        <input type="text" th:field="*{primerNombre}" class="form-control" required/>
                    </div>

                    <div class="col-md-3 mb-3">
                        <label>Segundo Nombre</label>
                        <input type="text" th:field="*{segundoNombre}" class="form-control"/>
                    </div>

                    <div class="col-md-3 mb-3">
                        <label>Primer Apellido *</label>
                        <input type="text" th:field="*{primerApellido}" class="form-control" required/>
                    </div>

                    <div class="col-md-3 mb-3">
                        <label>Segundo Apellido</label>
                        <input type="text" th:field="*{segundoApellido}" class="form-control"/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Correo Electrónico</label>
                        <input type="email" th:field="*{correo}" class="form-control"/>
                    </div>

                    <div class="col-md-3 mb-3">
                        <label>Teléfono</label>
                        <input type="text" th:field="*{telefono}" class="form-control"/>
                    </div>

                    <div class="col-md-3 mb-3">
                        <label>Programa</label>
                        <input type="text" th:field="*{programa}" class="form-control" placeholder="Ing. Sistemas"/>
                    </div>
                </div>
            </div>
        </div>

        <!-- Puntaje Global -->
        <div class="card mt-3">
            <div class="card-header bg-success text-white">
                <h5>Puntaje Global</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Puntaje Total Saber Pro</label>
                        <input type="number" th:field="*{puntajeTotal}" id="puntajeTotal" class="form-control" 
                               onchange="calcularNivel('puntajeTotal', 'nivelTotal', 300)"/>
                    </div>

                    <div class="col-md-6 mb-3">
                        <label>Nivel Total</label>
                        <input type="text" th:field="*{nivelTotal}" id="nivelTotal" class="form-control" readonly/>
                    </div>
                </div>
            </div>
        </div>

        <!-- Competencias Básicas -->
        <div class="card mt-3">
            <div class="card-header bg-warning">
                <h5>Competencias Básicas</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label>Comunicación Escrita</label>
                        <input type="number" th:field="*{comunicacionEscrita}" id="comunicacionEscrita" class="form-control"
                               onchange="calcularNivel('comunicacionEscrita', 'comunicacionEscritaNivel', 200)"/>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label>Nivel</label>
                        <input type="text" th:field="*{comunicacionEscritaNivel}" id="comunicacionEscritaNivel" class="form-control" readonly/>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label>Razonamiento Cuantitativo</label>
                        <input type="number" th:field="*{razonamientoCuantitativo}" id="razonamientoCuantitativo" class="form-control"
                               onchange="calcularNivel('razonamientoCuantitativo', 'razonamientoCuantitativoNivel', 200)"/>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label>Nivel</label>
                        <input type="text" th:field="*{razonamientoCuantitativoNivel}" id="razonamientoCuantitativoNivel" class="form-control" readonly/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label>Lectura Crítica</label>
                        <input type="number" th:field="*{lecturaCritica}" id="lecturaCritica" class="form-control"
                               onchange="calcularNivel('lecturaCritica', 'lecturaCriticaNivel', 200)"/>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label>Nivel</label>
                        <input type="text" th:field="*{lecturaCriticaNivel}" id="lecturaCriticaNivel" class="form-control" readonly/>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label>Competencias Ciudadanas</label>
                        <input type="number" th:field="*{competenciasCiudadanas}" id="competenciasCiudadanas" class="form-control"
                               onchange="calcularNivel('competenciasCiudadanas', 'competenciasCiudadanasNivel', 200)"/>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label>Nivel</label>
                        <input type="text" th:field="*{competenciasCiudadanasNivel}" id="competenciasCiudadanasNivel" class="form-control" readonly/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label>Nivel de Inglés</label>
                        <select th:field="*{inglesNivel}" id="inglesNivel" class="form-control">
                            <option value="">Seleccione nivel...</option>
                            <option value="A-">A-</option>
                            <option value="A1">A1</option>
                            <option value="A2">A2</option>
                            <option value="B1">B1</option>
                            <option value="B2">B2</option>
                            <option value="C1">C1</option>
                            <option value="C2">C2</option>
                        </select>
                        <div class="form-text">
                            El nivel de inglés se evalúa únicamente por nivel (A-, A1, A2, B1, B2, C1, C2)
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Competencias Específicas -->
        <div class="card mt-3">
            <div class="card-header bg-secondary text-white">
                <h5>Competencias Específicas (Ingeniería)</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label>Formulación de Proyectos</label>
                        <input type="number" th:field="*{formulacionProyectos}" id="formulacionProyectos" class="form-control"
                               onchange="calcularNivel('formulacionProyectos', 'formulacionProyectosNivel', 200)"/>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label>Nivel</label>
                        <input type="text" th:field="*{formulacionProyectosNivel}" id="formulacionProyectosNivel" class="form-control" readonly/>
                    </div>

                    <div class="col-md-4 mb-3">
                        <label>Pensamiento Científico</label>
                        <input type="number" th:field="*{pensamientoCientifico}" id="pensamientoCientifico" class="form-control"
                               onchange="calcularNivel('pensamientoCientifico', 'pensamientoCientificoNivel', 200)"/>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label>Nivel</label>
                        <input type="text" th:field="*{pensamientoCientificoNivel}" id="pensamientoCientificoNivel" class="form-control" readonly/>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label>Diseño de Software</label>
                        <input type="number" th:field="*{disenoSoftware}" id="disenoSoftware" class="form-control"
                               onchange="calcularNivel('disenoSoftware', 'disenoSoftwareNivel', 200)"/>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label>Nivel</label>
                        <input type="text" th:field="*{disenoSoftwareNivel}" id="disenoSoftwareNivel" class="form-control" readonly/>
                    </div>
                </div>
            </div>
        </div>

        <div class="mt-3 mb-4">
            <button type="submit" class="btn btn-success btn-lg">Guardar</button>
            <a href="/estudiantes" class="btn btn-secondary btn-lg">Cancelar</a>
        </div>

    </form>
</div>

<script>
    function calcularNivel(inputId, nivelId, maxPuntaje = 300) {
        const puntaje = parseInt(document.getElementById(inputId).value);
        const nivelInput = document.getElementById(nivelId);

        if (isNaN(puntaje) || puntaje < 0) {
            nivelInput.value = '';
            return;
        }

        let nivel = '';

        // RANGO UNIVERSAL 0–300 PARA TODO
        if (puntaje >= 0 && puntaje <= 125) {
            nivel = 'Nivel 1';
        } else if (puntaje >= 126 && puntaje <= 155) {
            nivel = 'Nivel 2';
        } else if (puntaje >= 156 && puntaje <= 200) {
            nivel = 'Nivel 3';
        } else if (puntaje >= 201 && puntaje <= 300) {
            nivel = 'Nivel 4';
        } else {
            nivel = 'Puntaje inválido';
        }

        nivelInput.value = nivel;
    }
</script>
</body>
</html>